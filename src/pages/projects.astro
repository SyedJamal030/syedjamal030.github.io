---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import ProjectCard from "../components/projects/ProjectCard.astro";

const allProjects = await getCollection("projects");
const sortedProjects = allProjects.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const categories = [
  "All",
  ...new Set(sortedProjects.map((p) => p.data.category)),
];
---

<Layout
  title="Projects | Senior React Developer | Syed Jamal"
  description="Explore a collection of 10+ successful web applications built for international clients. Featuring advanced React architecture, Next.js optimization, and high-performance frontend solutions."
  className="pt-20"
>
  <main class="py-20 lg:py-32 container mx-auto px-6">
    <div class="max-w-4xl mb-20">
      <h1 class="text-4xl md:text-6xl italic tracking-tight mb-6 font-black">
        Selected <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary"
          >Works</span
        >
      </h1>
      <p class="text-lg md:text-xl text-muted-foreground leading-relaxed">
        Detailed case studies focusing on performance, scalability, and
        technical architecture.
      </p>
    </div>

    <div class="flex flex-wrap gap-4 mb-12" id="filter-bar">
      {
        categories.map((cat) => (
          <button
            data-filter={cat}
            class="filter-btn px-6 py-2 rounded-full border border-border bg-card text-xs font-bold uppercase tracking-widest transition-all hover:border-primary aria-pressed:bg-primary aria-pressed:text-primary-foreground aria-pressed:border-primary"
            aria-pressed={cat === "All" ? "true" : "false"}
          >
            {cat}
          </button>
        ))
      }
    </div>

    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
      id="projects-grid"
    >
      {
        sortedProjects.map((project) => (
          <div class="project-item" data-category={project.data.category}>
            <ProjectCard project={project} />
          </div>
        ))
      }
    </div>
  </main>
</Layout>

<script>
  const initProjects = () => {
    const filterBtns = document.querySelectorAll("[data-filter]");
    const projectItems = document.querySelectorAll(".project-item");

    if (!filterBtns.length) return;

    filterBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        // Use btn.dataset.filter for cleaner access
        const filter = (btn as HTMLElement).dataset.filter;

        // Update UI state
        filterBtns.forEach((b) => b.setAttribute("aria-pressed", "false"));
        btn.setAttribute("aria-pressed", "true");

        projectItems.forEach((item) => {
          const projectItem = item as HTMLElement;
          const category = projectItem.dataset.category;

          if (filter === "All" || category === filter) {
            projectItem.style.display = "block";
            projectItem.classList.add("animate-fade-in");
          } else {
            projectItem.style.display = "none";
            projectItem.classList.remove("animate-fade-in");
          }
        });
      });
    });
  };

  initProjects();
  document.addEventListener("astro:page-load", initProjects);
</script>
