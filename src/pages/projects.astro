---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import ProjectCard from "../components/projects/ProjectCard.astro";
import Categories from "../components/projects/Categories.astro";

const allProjects = await getCollection("projects");
const sortedProjects = allProjects.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const categories = [
  "All",
  ...new Set(sortedProjects.map((p) => p.data.category)),
];
---

<Layout
  title="Projects | Senior React Developer | Syed Jamal"
  description="Explore a collection of 10+ successful web applications built for international clients. Featuring advanced React architecture, Next.js optimization, and high-performance frontend solutions."
  className="pt-20"
>
  <main class="py-10 md:py-20 lg:py-32">
    <div class="lg:container mx-auto px-6">
      <div class="mb-20">
        <h1 class="text-4xl font-bold tracking-tight sm:text-5xl">
          Selected <span class="text-primary">Work</span>
        </h1>
        <p class="text-muted-foreground max-w-2xl text-lg">
          Detailed case studies focusing on performance, scalability, and
          technical architecture.
        </p>
      </div>

      <div class="flex flex-wrap gap-4 mb-12" id="filter-bar">
        <Categories categories={categories} />
      </div>

      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
        id="projects-grid"
      >
        {
          sortedProjects.map((project) => (
            <div class="project-item" data-category={project.data.category}>
              <ProjectCard project={project} />
            </div>
          ))
        }
      </div>
    </div>
  </main>
</Layout>

<script>
  const initProjects = () => {
    const filterBtns = document.querySelectorAll("[data-filter]");
    const projectItems = document.querySelectorAll(".project-item");

    if (!filterBtns.length) return;

    filterBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        const filter = (btn as HTMLElement).dataset.filter;
        filterBtns.forEach((b) => b.setAttribute("aria-pressed", "false"));
        btn.setAttribute("aria-pressed", "true");

        projectItems.forEach((item) => {
          const projectItem = item as HTMLElement;
          const category = projectItem.dataset.category;

          if (filter === "All" || category === filter) {
            projectItem.style.display = "block";
            projectItem.classList.add("animate-fade-in");
          } else {
            projectItem.style.display = "none";
            projectItem.classList.remove("animate-fade-in");
          }
        });
      });
    });
  };

  initProjects();
  document.addEventListener("astro:page-load", initProjects);
</script>
