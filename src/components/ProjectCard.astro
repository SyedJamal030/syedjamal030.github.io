---
import type { CollectionEntry } from "astro:content";
interface Props {
  project: CollectionEntry<"projects">;
}

const { project } = Astro.props;
const { title, description, tags, link } = project.data;
const { Content } = await project.render();
const modalId = `modal-${project.slug}`;
---

<article
  class="group bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 rounded-2xl p-6 hover:shadow-xl hover:border-indigo-200 transition-all duration-300 flex flex-col h-full"
>
  <div class="flex-1">
    <div class="flex gap-2 mb-4 flex-wrap">
      {
        tags.map((tag) => (
          <span class="text-[10px] uppercase tracking-wider font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded">
            {tag}
          </span>
        ))
      }
    </div>

    <h3
      class="text-xl font-bold text-slate-900 group-hover:text-indigo-600 transition-colors"
    >
      {title}
    </h3>

    <p class="mt-3 text-slate-600 leading-relaxed text-sm">
      {description}
    </p>
  </div>

  <div class="mt-6 pt-6 border-t border-slate-100">
    <a
      target="_blank"
      href={link || "#"}
      class="inline-flex items-center text-sm font-bold text-indigo-600 hover:text-indigo-500"
    >
      View Source Code
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4 ml-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
      </svg>
    </a>
    <button
      data-modal-target={modalId}
      class="inline-flex items-center text-sm font-bold text-indigo-600 hover:text-indigo-500"
    >
      Read Case Study
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-4 w-4 ml-1"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
      </svg>
    </button>
  </div>
  <dialog
    id={modalId}
    class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 p-0 rounded-2xl backdrop:bg-slate-900/50 backdrop:backdrop-blur-sm w-full max-w-2xl border-none shadow-2xl"
  >
    <div class="p-8 bg-white dark:bg-slate-900 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-start mb-6">
        <div>
          <h2 class="text-3xl font-bold text-slate-900">
            {project.data.title}
          </h2>
          <p class="text-slate-500 italic mt-1">{project.data.description}</p>
        </div>
        <button
          data-modal-close
          class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button
        >
      </div>

      <div class="prose prose-slate dark:prose-invert max-w-none mb-8">
        <Content />
      </div>

      <div class="flex gap-4 border-t pt-6">
        {
          project.data.link && (
            <a
              href={project.data.link}
              target="_blank"
              class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold"
            >
              Live Link
            </a>
          )
        }
      </div>
    </div>
  </dialog>
</article>

<script>
  function setupModals() {
    const openButtons = document.querySelectorAll("[data-modal-target]");
    const closeButtons = document.querySelectorAll("[data-modal-close]");

    openButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const modalId = btn.getAttribute("data-modal-target");
        if (modalId) {
          const modal = document.getElementById(modalId) as HTMLDialogElement;
          modal?.showModal();
          document.documentElement.classList.add("overflow-hidden");
        }
      });
    });

    closeButtons.forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const modal = (e.target as HTMLElement).closest("dialog");
        modal?.close();
        document.documentElement.classList.remove("overflow-hidden");
      });
    });

    // Close on clicking outside the modal
    document.querySelectorAll("dialog").forEach((modal) => {
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.close();
          document.documentElement.classList.remove("overflow-hidden");
        }
      });
    });
  }

  // Run on initial load
  setupModals();
</script>
